version: 1
applications:
  - appRoot: "stripy"
    frontend:
      phases:
        preBuild:
          commands:
            - env | grep -e DB_HOST -e DB_USER -e DB_PASSWORD -e DB_NAME -e POSTGRES_URL -e AMPLIFY_MONOREPO_APP_ROOT="stripy" >> .env.production
            - npm ci --cache .npm --prefer-offline
        build:
          commands:
            - npm run build
    artifacts:
        baseDirectory: .next
        files:
        - '**/*'
    cache:
      paths:
        - .next/cache/**/*
        - .npm/**/*